<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>react-leaflet-deflate Example for react-leaflet v5</title>
		<meta name="description" content="https://github.com/mhasbie/react-leaflet-deflate">

		<script type="importmap">
        {
          "imports": {
            "react": "https://esm.sh/react@19.2.0/",
            "react-dom/client": "https://esm.sh/react-dom@19.2.0/client",
            "react-leaflet": "https://esm.sh/react-leaflet@5.0.0/",
            "@react-leaflet/core": "https://cdn.esm.sh/@react-leaflet/core",
            "react-leaflet-deflate": "https://esm.sh/react-leaflet-deflate@3.1.0/",
            "Leaflet.Deflate": "https://cdn.jsdelivr.net/npm/Leaflet.Deflate@2.1.0/dist/L.Deflate.min.js",
            "leaflet.markercluster": "https://unpkg.com/leaflet.markercluster"
          }
        }
  	    </script>

		<link href="https://fonts.googleapis.com/css?family=Lato:300,400,400italic,700,700italic" rel="stylesheet">
		<link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.min.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/leaflet.markercluster@1.5.3/dist/MarkerCluster.min.css" rel="stylesheet">
		<style>
			body {
				font-family: Arial, Helvetica, sans-serif;
			}
			.leaflet-container {
				position: absolute;
				top: 180px;
				bottom: 0;
				left: 0;
				right: 0;
			}
		</style>
	</head>
	<body>
		<div id="container"></div>
  
		<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.28.4/babel.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet-src.js"></script>
		<script src="./geojsonSamples.js"></script>
		<script type="text/babel" data-type="module">
			import React, { StrictMode, useState } from 'react';
        	import ReactDOMClient from 'react-dom/client';
			import { MapContainer, TileLayer } from 'react-leaflet';
			import Deflate from 'react-leaflet-deflate';

			const DeflateExample = () => {
				const [markerCluster, setMarkerCluster] = React.useState(true);
				const [dataSet, setDataSet] = React.useState(1);
				const [minSize, setMinSize] = React.useState(null);

				const onChangeMarkerCluster = (e) => {
					setMarkerCluster(e.target.checked);
				};

				const onChangeDataSet = (e) => {
					setDataSet(e.target.value);
				};

				const onChangeMinSize = (e) => {
					const minSizeInput = e.target.value;
					let minSizeFloat = parseFloat(minSizeInput);
					if(isNaN(minSizeFloat) || minSizeFloat <= 1.0) {
						minSizeFloat = null;
					}
					setMinSize(minSizeFloat);
				}

				const onEachFeature = (feature, featureLayer) => {
					featureLayer.bindPopup(`<div>This is feature #${feature.properties.id}</div>`);
					featureLayer.bindTooltip(`Feature: #${feature.properties.id}`);
				};

				const mapOptions = {
					center: [2.935403, 101.448205],
					zoom: 10,
					minZoom: 1,
					maxZoom: 22
				};

				const deflateOptions = {
					minSize: minSize || 20,
					markerCluster: markerCluster,
					data: dataSet == 1 ? sample1 : sample2,
					onEachFeature: onEachFeature
				};

				return (
					<StrictMode>
						<div>
							<h3>react-leaflet-deflate</h3>
							<fieldset>
								<label htmlFor="cluster">Enable marker clustering:</label>
								<input
									name="cluster"
									type="checkbox"
									defaultChecked={markerCluster}
									onChange={onChangeMarkerCluster}
								/>
							</fieldset>
							<fieldset>
								<label htmlFor="minSize">Min. Size:</label>
								<input
									name="minSize"
									value={minSize}
									onChange={onChangeMinSize}
								/>
							</fieldset>
							<fieldset>
								<label htmlFor="geojson">Pick GeoJSON data set:</label>
								<select name="geojson" value={dataSet} onChange={onChangeDataSet}>
									<option value="1">Data set 1</option>
									<option value="2">Data set 2</option>
								</select>
							</fieldset>
							<MapContainer {...mapOptions} >
								<TileLayer
									attribution='&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
									url='http://{s}.tile.osm.org/{z}/{x}/{y}.png'
								/>
								<Deflate {...deflateOptions} />
							</MapContainer>
						</div>
					</StrictMode>
				);
			}

			const root = ReactDOMClient.createRoot(document.getElementById('container'));
      		root.render(<DeflateExample />);
		</script>
	</body>
</html>